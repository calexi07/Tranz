<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Analysis Journal - $225</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2a 50%, #0f1e3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 98%;
            margin: 0 auto;
            padding: 0 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 2px solid #ff9500;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #ff9500, #ff7b00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #aaa;
            font-size: 1.1em;
        }

        .nav-buttons {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #ff9500, #ff7b00);
            color: #fff;
            border: none;
            padding: 12px 30px;
            margin: 0;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 149, 0, 0.5);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #fff, #e0e0e0);
            color: #000;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 149, 0, 0.2);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #ff9500;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9em;
        }

        input, select, textarea {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff9500;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 10px rgba(255, 149, 0, 0.3);
        }

        select option {
            background: #1a1a1a;
            color: #fff;
        }

        textarea {
            resize: vertical;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .save-btn {
            background: linear-gradient(135deg, #ff9500, #ff7b00);
            color: #fff;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 149, 0, 0.5);
        }

        .table-container {
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 149, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            max-width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        thead {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 123, 0, 0.2));
        }

        th {
            padding: 12px 8px;
            text-align: left;
            color: #ff9500;
            font-weight: 600;
            border-bottom: 2px solid #ff9500;
            white-space: nowrap;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #ddd;
            font-size: 0.9em;
        }

        tr:hover {
            background: rgba(255, 149, 0, 0.05);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #888;
            font-size: 1.1em;
        }

        .edit-btn, .delete-btn {
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
            border: none;
            color: #fff;
            margin-right: 5px;
        }

        .edit-btn {
            background: linear-gradient(135deg, #4488ff, #0066cc);
        }

        .delete-btn {
            background: linear-gradient(135deg, #ff4444, #cc0000);
        }

        .edit-btn:hover, .delete-btn:hover {
            transform: scale(1.05);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            border: 5px solid rgba(255, 149, 0, 0.2);
            border-top: 5px solid #ff9500;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-section {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .analysis-section h3 {
            color: #ff9500;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .filter-section {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.08), rgba(255, 123, 0, 0.03));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 149, 0, 0.25);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .pair-filter-btn {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 123, 0, 0.1));
            border: 2px solid rgba(255, 149, 0, 0.4);
            color: #ff9500;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .pair-filter-btn:hover {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.3), rgba(255, 123, 0, 0.2));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .pair-filter-btn.active {
            background: linear-gradient(135deg, #ff9500, #ff7b00);
            border-color: #ff9500;
            color: #fff;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.5);
        }

        #pairButtonsContainer::-webkit-scrollbar {
            height: 8px;
        }

        #pairButtonsContainer::-webkit-scrollbar-track {
            background: rgba(255, 149, 0, 0.1);
            border-radius: 10px;
        }

        #pairButtonsContainer::-webkit-scrollbar-thumb {
            background: #ff9500;
            border-radius: 10px;
        }

        #pairButtonsContainer::-webkit-scrollbar-thumb:hover {
            background: #ff7b00;
        }

        #pairButtonsContainer.grabbing {
            cursor: grabbing;
        }

        .calendar-day {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 149, 0, 0.2);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .calendar-day:hover {
            background: rgba(255, 149, 0, 0.1);
            border-color: #ff9500;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .calendar-day.has-analysis {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 123, 0, 0.1));
            border-color: #ff9500;
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #ff9500, #ff7b00);
            border-color: #ff9500;
            color: #fff;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.5);
        }

        .calendar-day.other-month {
            opacity: 0.3;
            pointer-events: none;
        }

        .calendar-day-number {
            font-size: 1.2em;
            font-weight: 600;
        }

        .calendar-day-count {
            font-size: 0.8em;
            color: #ff9500;
            margin-top: 5px;
        }

        .calendar-day.selected .calendar-day-count {
            color: #fff;
        }

        .calendar-header {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            color: #ff9500;
            font-size: 0.9em;
        }

        .view-mode-btn.active {
            background: linear-gradient(135deg, #ff9500, #ff7b00) !important;
            color: #fff !important;
            border-color: #ff9500 !important;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <div style="font-size: 4em; line-height: 1;">üìä</div>
                <div style="text-align: center;">
                    <h1>Market Analysis Journal</h1>
                    <p style="margin: 5px 0 0 0; font-size: 1.2em; color: #ff9500; font-weight: 600;">$225 Personal Account</p>
                    <p style="margin: 3px 0 0 0; font-size: 0.9em;">Track & Review Your Market Analysis</p>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" id="btnList">Analysis History</button>
            <button class="nav-btn" id="btnForm" style="display: none;">Add Analysis</button>
            <button class="nav-btn" id="btnLogin" style="background: linear-gradient(135deg, #00cc88, #00aa72);">üîê Login</button>
            <button class="nav-btn" id="btnLogout" style="display: none; background: linear-gradient(135deg, #ff6b6b, #ee5a6f);">üö™ Logout</button>
        </div>

        <!-- Form Page -->
        <div id="formPage" class="page">
            <div class="form-container">
                <h2 style="margin-bottom: 25px; color: #ff9500;">üìä Add Market Analysis</h2>
                
                <!-- Basic Info -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="month">Month *</label>
                        <select id="month" required>
                            <option value="">Select</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="day">Day *</label>
                        <select id="day" required>
                            <option value="">Select</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="date">Date *</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="form-group">
                        <label for="year">Year *</label>
                        <select id="year" required>
                            <option value="">Select</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pair">Pair *</label>
                        <select id="pair" onchange="handlePairChange()" required>
                            <option value="">Select</option>
                            <option value="EUR/USD">EUR/USD</option>
                            <option value="GBP/USD">GBP/USD</option>
                            <option value="XAU/USD">XAU/USD</option>
                            <option value="USD/JPY">USD/JPY</option>
                            <option value="US100">US100</option>
                            <option value="GER40">GER40</option>
                            <option value="Other">Other...</option>
                        </select>
                    </div>
                    <div class="form-group" id="customPairGroup" style="display: none;">
                        <label for="customPair">Enter Pair</label>
                        <input type="text" id="customPair" placeholder="ex: AUD/USD, BTC/USD">
                    </div>
                </div>

                <!-- Weekly Analysis -->
                <div class="analysis-section">
                    <h3>üìÖ Weekly Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="weeklyAnalysis">Analysis</label>
                            <textarea id="weeklyAnalysis" rows="4" placeholder="Weekly market overview, key levels, bias..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="weeklyPhoto">Photo Link (Imgur, TradingView, etc.)</label>
                            <input type="url" id="weeklyPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <!-- Daily Analysis -->
                <div class="analysis-section">
                    <h3>üìä Daily Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="dailyAnalysis">Analysis</label>
                            <textarea id="dailyAnalysis" rows="4" placeholder="Daily zones, supply/demand, daily bias..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="dailyPhoto">Photo Link</label>
                            <input type="url" id="dailyPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <!-- 4H Analysis -->
                <div class="analysis-section">
                    <h3>‚è±Ô∏è 4H Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="fourHAnalysis">Analysis</label>
                            <textarea id="fourHAnalysis" rows="4" placeholder="4H structure, fractals, entry zones..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="fourHPhoto">Photo Link</label>
                            <input type="url" id="fourHPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <!-- 1H Analysis -->
                <div class="analysis-section">
                    <h3>‚ö° 1H Analysis</h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="oneHAnalysis">Analysis</label>
                            <textarea id="oneHAnalysis" rows="4" placeholder="1H entries, liquidity sweeps, timing..."></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="oneHPhoto">Photo Link</label>
                            <input type="url" id="oneHPhoto" placeholder="https://i.imgur.com/...">
                        </div>
                    </div>
                </div>

                <button class="save-btn" id="saveBtn">üíæ Save Analysis</button>
            </div>
        </div>

        <!-- List Page -->
        <div id="listPage" class="page active">
            <!-- Filters -->
            <div class="filter-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="color: #ff9500; margin: 0; font-size: 1.5em;">üîç Filters</h2>
                    <button onclick="resetFilters()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: #fff; border: none; padding: 12px 28px; border-radius: 25px; cursor: pointer; font-weight: 600;">üîÑ Reset</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="filterMonth">üìÖ Month</label>
                        <select id="filterMonth" onchange="applyFilters()">
                            <option value="">All months</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterDay">üìÜ Day</label>
                        <select id="filterDay" onchange="applyFilters()">
                            <option value="">All days</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterDateFrom">üìÖ Date From</label>
                        <input type="date" id="filterDateFrom" onchange="applyFilters()">
                    </div>
                    <div class="form-group">
                        <label for="filterDateTo">üìÖ Date To</label>
                        <input type="date" id="filterDateTo" onchange="applyFilters()">
                    </div>
                    <div class="form-group">
                        <label for="filterYear">üìÖ Year</label>
                        <select id="filterYear" onchange="applyFilters()">
                            <option value="">All years</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterPair">üí± Pair</label>
                        <select id="filterPair" onchange="applyFilters()">
                            <option value="">All pairs</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Quick Pair Filters -->
            <div style="background: linear-gradient(135deg, rgba(255, 149, 0, 0.08), rgba(255, 123, 0, 0.03)); backdrop-filter: blur(10px); border: 1px solid rgba(255, 149, 0, 0.25); border-radius: 20px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);">
                <h3 style="color: #ff9500; margin: 0 0 15px 0; font-size: 1.2em; display: flex; align-items: center; gap: 10px;">
                    <span>‚ö°</span> Quick Pair Filter
                </h3>
                <div id="pairButtonsContainer" style="display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; cursor: grab; user-select: none; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: #ff9500 rgba(255, 149, 0, 0.1);">
                    <!-- Buttons will be inserted here -->
                </div>
            </div>

            <!-- View Mode Toggle -->
            <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 30px;">
                <button id="btnJournalView" class="view-mode-btn active" onclick="switchView('journal')" style="background: linear-gradient(135deg, #ff9500, #ff7b00); color: #fff; border: none; padding: 14px 40px; border-radius: 25px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 149, 0, 0.4);">
                    üìã Journal View
                </button>
                <button id="btnCalendarView" class="view-mode-btn" onclick="switchView('calendar')" style="background: rgba(255, 149, 0, 0.2); color: #ff9500; border: 2px solid rgba(255, 149, 0, 0.4); padding: 14px 40px; border-radius: 25px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s ease;">
                    üìÖ Calendar View
                </button>
            </div>

            <!-- Journal View -->
            <!-- Journal View -->
            <div id="journalView" style="display: block;">
                <div class="table-container">
                    <h2 style="margin-bottom: 20px; color: #ff9500;">Analysis History</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Day</th>
                                <th>Date</th>
                                <th>Year</th>
                                <th>Pair</th>
                                <th>Weekly Analysis</th>
                                <th>Weekly Photo</th>
                                <th>Daily Analysis</th>
                                <th>Daily Photo</th>
                                <th>4H Analysis</th>
                                <th>4H Photo</th>
                                <th>1H Analysis</th>
                                <th>1H Photo</th>
                                <th>View/Share</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="analysisBody">
                            <tr>
                                <td colspan="15" class="no-data">Loading analyses...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Calendar View -->
            <div id="calendarView" style="display: none;">
                <div style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 149, 0, 0.2); border-radius: 15px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
                    
                    <!-- Calendar Controls -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <button onclick="changeMonth(-1)" style="background: linear-gradient(135deg, #ff9500, #ff7b00); color: #fff; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s ease;">
                            ‚óÑ Previous
                        </button>
                        
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <select id="calendarMonth" onchange="renderCalendar()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 149, 0, 0.3); border-radius: 8px; padding: 12px 20px; color: #fff; font-size: 1em; font-weight: 600; cursor: pointer;">
                                <option value="0">January</option>
                                <option value="1">February</option>
                                <option value="2">March</option>
                                <option value="3">April</option>
                                <option value="4">May</option>
                                <option value="5">June</option>
                                <option value="6">July</option>
                                <option value="7">August</option>
                                <option value="8">September</option>
                                <option value="9">October</option>
                                <option value="10">November</option>
                                <option value="11">December</option>
                            </select>
                            
                            <select id="calendarYear" onchange="renderCalendar()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 149, 0, 0.3); border-radius: 8px; padding: 12px 20px; color: #fff; font-size: 1em; font-weight: 600; cursor: pointer;">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                            </select>
                        </div>
                        
                        <button onclick="changeMonth(1)" style="background: linear-gradient(135deg, #ff9500, #ff7b00); color: #fff; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s ease;">
                            Next ‚ñ∫
                        </button>
                    </div>

                    <!-- Calendar Grid -->
                    <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 30px;">
                        <!-- Calendar will be rendered here -->
                    </div>

                    <!-- Selected Day Analyses -->
                    <div id="selectedDayAnalyses" style="display: none; background: rgba(255, 149, 0, 0.05); border: 2px solid rgba(255, 149, 0, 0.3); border-radius: 15px; padding: 25px; margin-top: 30px;">
                        <h3 id="selectedDayTitle" style="color: #ff9500; margin-bottom: 20px; font-size: 1.5em;"></h3>
                        <div id="selectedDayContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="loading-overlay" id="loginModal">
        <div style="background: rgba(255, 255, 255, 0.98); padding: 40px; border-radius: 20px; max-width: 400px; width: 90%;">
            <h2 style="color: #ff9500; margin-bottom: 25px; text-align: center;">üîê Login</h2>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #333; margin-bottom: 8px; font-weight: 600;">Username</label>
                <input type="text" id="loginUsername" placeholder="Enter username" style="width: 100%; padding: 12px; border: 2px solid #ff9500; border-radius: 8px; color: #333;">
            </div>
            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #333; margin-bottom: 8px; font-weight: 600;">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password" style="width: 100%; padding: 12px; border: 2px solid #ff9500; border-radius: 8px; color: #333;" onkeypress="if(event.key==='Enter') attemptLogin()">
            </div>
            <div id="loginError" style="color: #ff4444; margin-bottom: 15px; text-align: center; display: none;"></div>
            <div style="display: flex; gap: 10px;">
                <button onclick="attemptLogin()" style="flex: 1; background: linear-gradient(135deg, #00cc88, #00aa72); color: #fff; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">Login</button>
                <button onclick="closeLoginModal()" style="flex: 1; background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: #fff; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- View Analysis Modal -->
    <div class="loading-overlay" id="viewModal" style="display: none;">
        <div style="background: linear-gradient(135deg, rgba(26, 26, 42, 0.98), rgba(15, 30, 58, 0.98)); padding: 40px; border-radius: 20px; max-width: 900px; width: 90%; max-height: 85vh; overflow-y: auto; border: 2px solid rgba(255, 149, 0, 0.5);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 id="viewModalTitle" style="color: #ff9500; margin: 0; font-size: 2em;">Analysis</h2>
                <button onclick="closeViewModal()" style="background: rgba(255, 107, 107, 0.2); color: #ff6b6b; border: 2px solid #ff6b6b; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.5em; font-weight: bold; transition: all 0.3s ease;">√ó</button>
            </div>
            
            <div id="viewModalContent" style="color: #ddd; line-height: 1.8; font-size: 1.05em;">
                <!-- Content will be inserted here -->
            </div>

            <div style="margin-top: 30px; text-align: center; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button onclick="copyForTradingViewFromModal()" style="background: linear-gradient(135deg, #2962FF, #1E53E5); color: #fff; border: none; padding: 14px 40px; border-radius: 25px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(41, 98, 255, 0.4);">
                    üìà Copy for TradingView
                </button>
                <button onclick="shareFromModal()" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: #fff; border: none; padding: 14px 40px; border-radius: 25px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);">
                    üìã Copy for Discord
                </button>
                <button onclick="closeViewModal()" style="background: linear-gradient(135deg, #ff9500, #ff7b00); color: #fff; border: none; padding: 14px 40px; border-radius: 25px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 149, 0, 0.4);">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay active" id="loadingOverlay">
        <div style="text-align: center;">
            <div class="spinner"></div>
            <div style="color: #ff9500; font-size: 1.3em; font-weight: bold;">Loading...</div>
        </div>
    </div>

    <script>
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby545E0z1U_T4y7Obgp7jbkhjEM-nTQ14zccKu3_WhAWI93028iGy3JHPHk9XJvU1_5/exec';

const CREDENTIALS = {
    username: 'calexi07',
    password: '101994acs!'
};

let analyses = [];
let filteredAnalyses = [];
let editingIndex = -1;
let isLoggedIn = false;

// DOM
const formPage = document.getElementById('formPage');
const listPage = document.getElementById('listPage');
const btnForm = document.getElementById('btnForm');
const btnList = document.getElementById('btnList');
const btnLogin = document.getElementById('btnLogin');
const btnLogout = document.getElementById('btnLogout');
const saveBtn = document.getElementById('saveBtn');
const analysisBody = document.getElementById('analysisBody');
const loadingOverlay = document.getElementById('loadingOverlay');

// Show/Hide Loading
function showLoading() {
    loadingOverlay.classList.add('active');
}

function hideLoading() {
    loadingOverlay.classList.remove('active');
}

// Navigation
btnLogin.onclick = () => showLoginModal();
btnLogout.onclick = () => logout();
btnForm.onclick = () => showPage('form');
btnList.onclick = () => {
    showPage('list');
    loadAnalyses();
};

function handlePairChange() {
    const pairSelect = document.getElementById('pair');
    const customPairGroup = document.getElementById('customPairGroup');
    
    if (pairSelect.value === 'Other') {
        customPairGroup.style.display = 'block';
        document.getElementById('customPair').required = true;
    } else {
        customPairGroup.style.display = 'none';
        document.getElementById('customPair').required = false;
        document.getElementById('customPair').value = '';
    }
}

function showPage(page) {
    formPage.classList.toggle('active', page === 'form');
    listPage.classList.toggle('active', page === 'list');
    btnForm.classList.toggle('active', page === 'form');
    btnList.classList.toggle('active', page === 'list');
}

// Login System
function showLoginModal() {
    document.getElementById('loginModal').style.display = 'flex';
    document.getElementById('loginUsername').value = '';
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginError').style.display = 'none';
}

function closeLoginModal() {
    document.getElementById('loginModal').style.display = 'none';
}

function attemptLogin() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    
    if (username === CREDENTIALS.username && password === CREDENTIALS.password) {
        isLoggedIn = true;
        localStorage.setItem('analysisAuth', 'true');
        closeLoginModal();
        updateUIForLogin();
        alert('Login successful!');
    } else {
        document.getElementById('loginError').textContent = 'Invalid credentials';
        document.getElementById('loginError').style.display = 'block';
    }
}

function logout() {
    if (confirm('Logout?')) {
        isLoggedIn = false;
        localStorage.removeItem('analysisAuth');
        updateUIForLogin();
        showPage('list');
    }
}

function updateUIForLogin() {
    btnForm.style.display = isLoggedIn ? 'inline-block' : 'none';
    btnLogin.style.display = isLoggedIn ? 'none' : 'inline-block';
    btnLogout.style.display = isLoggedIn ? 'inline-block' : 'none';
    updateTable();
}

function checkAuth() {
    if (localStorage.getItem('analysisAuth') === 'true') {
        isLoggedIn = true;
        updateUIForLogin();
    }
}

// Load Analyses
function loadAnalyses() {
    showLoading();
    fetch(GOOGLE_SCRIPT_URL + '?action=get&sheet=Sheet1')
        .then(r => r.json())
        .then(res => {
            hideLoading();
            if (res.result === 'success') {
                analyses = res.data || [];
                filteredAnalyses = [...analyses];
                populateFilterDropdowns();
                updateTable();
            } else {
                throw new Error(res.message);
            }
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            analysisBody.innerHTML = '<tr><td colspan="14" class="no-data">Loading error</td></tr>';
        });
}

// Filters
function populateFilterDropdowns() {
    const months = [...new Set(analyses.map(a => a.month))].filter(Boolean).sort();
    const monthSelect = document.getElementById('filterMonth');
    monthSelect.innerHTML = '<option value="">All months</option>';
    months.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m;
        opt.textContent = m;
        monthSelect.appendChild(opt);
    });
    
    const pairs = [...new Set(analyses.map(a => a.pair))].filter(Boolean).sort();
    const pairSelect = document.getElementById('filterPair');
    pairSelect.innerHTML = '<option value="">All pairs</option>';
    pairs.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.textContent = p;
        pairSelect.appendChild(opt);
    });
    
    // Populate pair filter buttons
    populatePairButtons(pairs);
}

let activePairFilter = '';

function populatePairButtons(pairs) {
    const container = document.getElementById('pairButtonsContainer');
    container.innerHTML = '';
    
    // Add "All" button
    const allBtn = document.createElement('button');
    allBtn.className = 'pair-filter-btn active';
    allBtn.textContent = 'üåê All Pairs';
    allBtn.onclick = () => filterByPair('');
    container.appendChild(allBtn);
    
    // Add button for each pair
    pairs.forEach(pair => {
        const btn = document.createElement('button');
        btn.className = 'pair-filter-btn';
        btn.textContent = pair;
        btn.onclick = () => filterByPair(pair);
        container.appendChild(btn);
    });
    
    // Add drag scroll functionality
    setupDragScroll(container);
}

function filterByPair(pair) {
    activePairFilter = pair;
    
    // Update button states
    const buttons = document.querySelectorAll('.pair-filter-btn');
    buttons.forEach(btn => {
        if ((pair === '' && btn.textContent === 'üåê All Pairs') || btn.textContent === pair) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    // Update dropdown to match
    document.getElementById('filterPair').value = pair;
    
    // Apply filters
    applyFilters();
}

function setupDragScroll(container) {
    let isDown = false;
    let startX;
    let scrollLeft;
    
    container.addEventListener('mousedown', (e) => {
        isDown = true;
        container.classList.add('grabbing');
        startX = e.pageX - container.offsetLeft;
        scrollLeft = container.scrollLeft;
    });
    
    container.addEventListener('mouseleave', () => {
        isDown = false;
        container.classList.remove('grabbing');
    });
    
    container.addEventListener('mouseup', () => {
        isDown = false;
        container.classList.remove('grabbing');
    });
    
    container.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - container.offsetLeft;
        const walk = (x - startX) * 2;
        container.scrollLeft = scrollLeft - walk;
    });
    
    // Touch support for mobile
    container.addEventListener('touchstart', (e) => {
        startX = e.touches[0].pageX - container.offsetLeft;
        scrollLeft = container.scrollLeft;
    });
    
    container.addEventListener('touchmove', (e) => {
        const x = e.touches[0].pageX - container.offsetLeft;
        const walk = (x - startX) * 2;
        container.scrollLeft = scrollLeft - walk;
    });
}

function applyFilters() {
    const month = document.getElementById('filterMonth').value;
    const day = document.getElementById('filterDay').value;
    const dateFrom = document.getElementById('filterDateFrom').value;
    const dateTo = document.getElementById('filterDateTo').value;
    const year = document.getElementById('filterYear').value;
    const pair = document.getElementById('filterPair').value;
    
    filteredAnalyses = analyses.filter(a => {
        if (month && a.month !== month) return false;
        if (day && a.day !== day) return false;
        if (year && a.year !== year) return false;
        if (pair && a.pair !== pair) return false;
        
        // Date range filter
        if (dateFrom && a.date) {
            const analysisDate = new Date(a.date);
            const fromDate = new Date(dateFrom);
            if (analysisDate < fromDate) return false;
        }
        if (dateTo && a.date) {
            const analysisDate = new Date(a.date);
            const toDate = new Date(dateTo);
            if (analysisDate > toDate) return false;
        }
        
        return true;
    });
    
    updateTable();
}

function resetFilters() {
    document.getElementById('filterMonth').value = '';
    document.getElementById('filterDay').value = '';
    document.getElementById('filterDateFrom').value = '';
    document.getElementById('filterDateTo').value = '';
    document.getElementById('filterYear').value = '';
    document.getElementById('filterPair').value = '';
    filteredAnalyses = [...analyses];
    updateTable();
}

// Table
function updateTable() {
    if (!filteredAnalyses.length) {
        analysisBody.innerHTML = '<tr><td colspan="15" class="no-data">No analyses yet</td></tr>';
        return;
    }
    
    analysisBody.innerHTML = '';
    
    filteredAnalyses.forEach((a, i) => {
        const tr = document.createElement('tr');
        
        const formatPhoto = (url) => {
            if (!url) return '-';
            return `<a href="${url}" target="_blank" style="color: #ff9500; text-decoration: none;">üì∏ View</a>`;
        };
        
        const truncate = (text) => {
            if (!text) return '-';
            return text.length > 50 ? text.substring(0, 47) + '...' : text;
        };
        
        tr.innerHTML = `
            <td>${a.month}</td>
            <td>${a.day}</td>
            <td>${a.date ? new Date(a.date).toLocaleDateString('ro-RO') : '-'}</td>
            <td>${a.year}</td>
            <td>${a.pair}</td>
            <td title="${a.weeklyAnalysis || ''}">${truncate(a.weeklyAnalysis)}</td>
            <td>${formatPhoto(a.weeklyPhoto)}</td>
            <td title="${a.dailyAnalysis || ''}">${truncate(a.dailyAnalysis)}</td>
            <td>${formatPhoto(a.dailyPhoto)}</td>
            <td title="${a.fourHAnalysis || ''}">${truncate(a.fourHAnalysis)}</td>
            <td>${formatPhoto(a.fourHPhoto)}</td>
            <td title="${a.oneHAnalysis || ''}">${truncate(a.oneHAnalysis)}</td>
            <td>${formatPhoto(a.oneHPhoto)}</td>
            <td>
                <button onclick="viewAnalysis(${analyses.indexOf(a)})" style="background: linear-gradient(135deg, #4d9fff, #3d7fff); color: #fff; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em; font-weight: 600; transition: all 0.3s ease; margin-right: 5px;">
                    üëÅÔ∏è View
                </button>
                <button onclick="shareToTradingView(${analyses.indexOf(a)}, event)" style="background: linear-gradient(135deg, #2962FF, #1E53E5); color: #fff; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em; font-weight: 600; transition: all 0.3s ease; margin-right: 5px;">
                    üìà TV
                </button>
                <button onclick="shareToDiscord(${analyses.indexOf(a)}, event)" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: #fff; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em; font-weight: 600; transition: all 0.3s ease;">
                    üìã Discord
                </button>
            </td>
            <td>
                ${isLoggedIn ? `
                    <button class="delete-btn" onclick="deleteAnalysis(${analyses.indexOf(a)})">Delete</button>
                    <button class="edit-btn" onclick="editAnalysis(${analyses.indexOf(a)})">Edit</button>
                ` : '-'}
            </td>
        `;
        
        analysisBody.appendChild(tr);
    });
}

// View Analysis Modal
let currentViewIndex = -1;

function viewAnalysis(index) {
    currentViewIndex = index;
    const a = analyses[index];
    
    // Format date
    const dateStr = a.date ? new Date(a.date).toLocaleDateString('ro-RO', { day: '2-digit', month: '2-digit', year: 'numeric' }) : `${a.day}, ${a.month} ${a.year}`;
    
    // Set title
    document.getElementById('viewModalTitle').textContent = `üìä ${dateStr} - ${a.pair}`;
    
    // Build content
    let content = '';
    
    // Weekly
    if (a.weeklyAnalysis || a.weeklyPhoto) {
        content += `
            <div style="background: rgba(255, 149, 0, 0.1); border-left: 4px solid #ff9500; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #ff9500; margin-bottom: 15px; font-size: 1.4em; display: flex; align-items: center; gap: 10px;">
                    <span>üìÖ</span> Weekly Timeframe
                </h3>
                ${a.weeklyAnalysis ? `<p style="margin-bottom: 15px; white-space: pre-wrap;">${a.weeklyAnalysis}</p>` : ''}
                ${a.weeklyPhoto ? `
                    <div style="margin-top: 15px;">
                        <img src="${a.weeklyPhoto}" alt="Weekly Chart" style="width: 100%; max-width: 100%; border-radius: 10px; border: 2px solid #ff9500; cursor: pointer;" onclick="window.open('${a.weeklyPhoto}', '_blank')" title="Click to open in new tab">
                    </div>
                ` : ''}
            </div>
        `;
    }
    
    // Daily
    if (a.dailyAnalysis || a.dailyPhoto) {
        content += `
            <div style="background: rgba(77, 159, 255, 0.1); border-left: 4px solid #4d9fff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #4d9fff; margin-bottom: 15px; font-size: 1.4em; display: flex; align-items: center; gap: 10px;">
                    <span>üìä</span> Daily Timeframe
                </h3>
                ${a.dailyAnalysis ? `<p style="margin-bottom: 15px; white-space: pre-wrap;">${a.dailyAnalysis}</p>` : ''}
                ${a.dailyPhoto ? `
                    <div style="margin-top: 15px;">
                        <img src="${a.dailyPhoto}" alt="Daily Chart" style="width: 100%; max-width: 100%; border-radius: 10px; border: 2px solid #4d9fff; cursor: pointer;" onclick="window.open('${a.dailyPhoto}', '_blank')" title="Click to open in new tab">
                    </div>
                ` : ''}
            </div>
        `;
    }
    
    // 4H
    if (a.fourHAnalysis || a.fourHPhoto) {
        content += `
            <div style="background: rgba(156, 39, 176, 0.1); border-left: 4px solid #9c27b0; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #9c27b0; margin-bottom: 15px; font-size: 1.4em; display: flex; align-items: center; gap: 10px;">
                    <span>‚è±Ô∏è</span> 4H Timeframe
                </h3>
                ${a.fourHAnalysis ? `<p style="margin-bottom: 15px; white-space: pre-wrap;">${a.fourHAnalysis}</p>` : ''}
                ${a.fourHPhoto ? `
                    <div style="margin-top: 15px;">
                        <img src="${a.fourHPhoto}" alt="4H Chart" style="width: 100%; max-width: 100%; border-radius: 10px; border: 2px solid #9c27b0; cursor: pointer;" onclick="window.open('${a.fourHPhoto}', '_blank')" title="Click to open in new tab">
                    </div>
                ` : ''}
            </div>
        `;
    }
    
    // 1H
    if (a.oneHAnalysis || a.oneHPhoto) {
        content += `
            <div style="background: rgba(0, 204, 136, 0.1); border-left: 4px solid #00cc88; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #00cc88; margin-bottom: 15px; font-size: 1.4em; display: flex; align-items: center; gap: 10px;">
                    <span>‚ö°</span> 1H Timeframe
                </h3>
                ${a.oneHAnalysis ? `<p style="margin-bottom: 15px; white-space: pre-wrap;">${a.oneHAnalysis}</p>` : ''}
                ${a.oneHPhoto ? `
                    <div style="margin-top: 15px;">
                        <img src="${a.oneHPhoto}" alt="1H Chart" style="width: 100%; max-width: 100%; border-radius: 10px; border: 2px solid #00cc88; cursor: pointer;" onclick="window.open('${a.oneHPhoto}', '_blank')" title="Click to open in new tab">
                    </div>
                ` : ''}
            </div>
        `;
    }
    
    if (!content) {
        content = '<p style="text-align: center; color: #888;">No analysis data available</p>';
    }
    
    document.getElementById('viewModalContent').innerHTML = content;
    document.getElementById('viewModal').style.display = 'flex';
}

function closeViewModal() {
    document.getElementById('viewModal').style.display = 'none';
    currentViewIndex = -1;
}

function shareFromModal() {
    if (currentViewIndex >= 0) {
        const a = analyses[currentViewIndex];
        const dateStr = a.date ? new Date(a.date).toLocaleDateString('ro-RO', { day: '2-digit', month: '2-digit', year: 'numeric' }) : `${a.day}, ${a.month} ${a.year}`;
        let template = `**üìä ${dateStr} - ${a.pair} Analysis**\n\n`;
        
        if (a.weeklyAnalysis || a.weeklyPhoto) {
            template += `**üìÖ WEEKLY TIMEFRAME**\n`;
            if (a.weeklyAnalysis) template += `${a.weeklyAnalysis}\n`;
            if (a.weeklyPhoto) template += `üì∏ Chart: ${a.weeklyPhoto}\n`;
            template += `\n`;
        }
        
        if (a.dailyAnalysis || a.dailyPhoto) {
            template += `**üìä DAILY TIMEFRAME**\n`;
            if (a.dailyAnalysis) template += `${a.dailyAnalysis}\n`;
            if (a.dailyPhoto) template += `üì∏ Chart: ${a.dailyPhoto}\n`;
            template += `\n`;
        }
        
        if (a.fourHAnalysis || a.fourHPhoto) {
            template += `**‚è±Ô∏è 4H TIMEFRAME**\n`;
            if (a.fourHAnalysis) template += `${a.fourHAnalysis}\n`;
            if (a.fourHPhoto) template += `üì∏ Chart: ${a.fourHPhoto}\n`;
            template += `\n`;
        }
        
        if (a.oneHAnalysis || a.oneHPhoto) {
            template += `**‚ö° 1H TIMEFRAME**\n`;
            if (a.oneHAnalysis) template += `${a.oneHAnalysis}\n`;
            if (a.oneHPhoto) template += `üì∏ Chart: ${a.oneHPhoto}\n`;
        }
        
        navigator.clipboard.writeText(template).then(() => {
            alert('‚úÖ Copied to clipboard! Paste in Discord.');
        }).catch(err => {
            alert('Copy failed! Please try again.');
        });
    }
}

function copyForTradingViewFromModal() {
    if (currentViewIndex >= 0) {
        const a = analyses[currentViewIndex];
        const dateStr = a.date ? new Date(a.date).toLocaleDateString('ro-RO', { day: '2-digit', month: '2-digit', year: 'numeric' }) : `${a.day}, ${a.month} ${a.year}`;
        
        let template = `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        template += `üìä ${a.pair} ANALYSIS - ${dateStr}\n`;
        template += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
        
        if (a.weeklyAnalysis || a.weeklyPhoto) {
            template += `üìÖ WEEKLY TIMEFRAME\n`;
            template += `${'‚îÄ'.repeat(50)}\n`;
            if (a.weeklyAnalysis) template += `${a.weeklyAnalysis}\n`;
            if (a.weeklyPhoto) template += `\nüì∏ Chart: ${a.weeklyPhoto}\n`;
            template += `\n`;
        }
        
        if (a.dailyAnalysis || a.dailyPhoto) {
            template += `üìä DAILY TIMEFRAME\n`;
            template += `${'‚îÄ'.repeat(50)}\n`;
            if (a.dailyAnalysis) template += `${a.dailyAnalysis}\n`;
            if (a.dailyPhoto) template += `\nüì∏ Chart: ${a.dailyPhoto}\n`;
            template += `\n`;
        }
        
        if (a.fourHAnalysis || a.fourHPhoto) {
            template += `‚è±Ô∏è 4H TIMEFRAME\n`;
            template += `${'‚îÄ'.repeat(50)}\n`;
            if (a.fourHAnalysis) template += `${a.fourHAnalysis}\n`;
            if (a.fourHPhoto) template += `\nüì∏ Chart: ${a.fourHPhoto}\n`;
            template += `\n`;
        }
        
        if (a.oneHAnalysis || a.oneHPhoto) {
            template += `‚ö° 1H TIMEFRAME\n`;
            template += `${'‚îÄ'.repeat(50)}\n`;
            if (a.oneHAnalysis) template += `${a.oneHAnalysis}\n`;
            if (a.oneHPhoto) template += `\nüì∏ Chart: ${a.oneHPhoto}\n`;
            template += `\n`;
        }
        
        template += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        template += `üí° Analysis by @YourUsername | ${dateStr}\n`;
        template += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
        
        navigator.clipboard.writeText(template).then(() => {
            alert('‚úÖ Copied to clipboard! Paste in TradingView comments.');
        }).catch(err => {
            alert('Copy failed! Please try again.');
        });
    }
}

// Share to Discord
function shareToDiscord(index, event) {
    const a = analyses[index];
    
    // Format date
    const dateStr = a.date ? new Date(a.date).toLocaleDateString('ro-RO', { day: '2-digit', month: '2-digit', year: 'numeric' }) : `${a.day}, ${a.month} ${a.year}`;
    
    // Build Discord-formatted template
    let template = `**üìä ${dateStr} - ${a.pair} Analysis**\n\n`;
    
    // Weekly
    if (a.weeklyAnalysis || a.weeklyPhoto) {
        template += `**üìÖ WEEKLY TIMEFRAME**\n`;
        if (a.weeklyAnalysis) {
            template += `${a.weeklyAnalysis}\n`;
        }
        if (a.weeklyPhoto) {
            template += `üì∏ Chart: ${a.weeklyPhoto}\n`;
        }
        template += `\n`;
    }
    
    // Daily
    if (a.dailyAnalysis || a.dailyPhoto) {
        template += `**üìä DAILY TIMEFRAME**\n`;
        if (a.dailyAnalysis) {
            template += `${a.dailyAnalysis}\n`;
        }
        if (a.dailyPhoto) {
            template += `üì∏ Chart: ${a.dailyPhoto}\n`;
        }
        template += `\n`;
    }
    
    // 4H
    if (a.fourHAnalysis || a.fourHPhoto) {
        template += `**‚è±Ô∏è 4H TIMEFRAME**\n`;
        if (a.fourHAnalysis) {
            template += `${a.fourHAnalysis}\n`;
        }
        if (a.fourHPhoto) {
            template += `üì∏ Chart: ${a.fourHPhoto}\n`;
        }
        template += `\n`;
    }
    
    // 1H
    if (a.oneHAnalysis || a.oneHPhoto) {
        template += `**‚ö° 1H TIMEFRAME**\n`;
        if (a.oneHAnalysis) {
            template += `${a.oneHAnalysis}\n`;
        }
        if (a.oneHPhoto) {
            template += `üì∏ Chart: ${a.oneHPhoto}\n`;
        }
    }
    
    // Copy to clipboard
    navigator.clipboard.writeText(template).then(() => {
        // Show success message
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        btn.style.background = 'linear-gradient(135deg, #00cc88, #00aa72)';
        
        setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = 'linear-gradient(135deg, #9c27b0, #7b1fa2)';
        }, 2000);
    }).catch(err => {
        alert('Copy failed! Please try again.');
        console.error(err);
    });
}

// Share to TradingView
function shareToTradingView(index, event) {
    const a = analyses[index];
    
    // Format date
    const dateStr = a.date ? new Date(a.date).toLocaleDateString('ro-RO', { day: '2-digit', month: '2-digit', year: 'numeric' }) : `${a.day}, ${a.month} ${a.year}`;
    
    // Build TradingView-formatted template
    let template = `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
    template += `üìä ${a.pair} ANALYSIS - ${dateStr}\n`;
    template += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
    
    // Weekly
    if (a.weeklyAnalysis || a.weeklyPhoto) {
        template += `üìÖ WEEKLY TIMEFRAME\n`;
        template += `${'‚îÄ'.repeat(50)}\n`;
        if (a.weeklyAnalysis) {
            template += `${a.weeklyAnalysis}\n`;
        }
        if (a.weeklyPhoto) {
            template += `\nüì∏ Chart: ${a.weeklyPhoto}\n`;
        }
        template += `\n`;
    }
    
    // Daily
    if (a.dailyAnalysis || a.dailyPhoto) {
        template += `üìä DAILY TIMEFRAME\n`;
        template += `${'‚îÄ'.repeat(50)}\n`;
        if (a.dailyAnalysis) {
            template += `${a.dailyAnalysis}\n`;
        }
        if (a.dailyPhoto) {
            template += `\nüì∏ Chart: ${a.dailyPhoto}\n`;
        }
        template += `\n`;
    }
    
    // 4H
    if (a.fourHAnalysis || a.fourHPhoto) {
        template += `‚è±Ô∏è 4H TIMEFRAME\n`;
        template += `${'‚îÄ'.repeat(50)}\n`;
        if (a.fourHAnalysis) {
            template += `${a.fourHAnalysis}\n`;
        }
        if (a.fourHPhoto) {
            template += `\nüì∏ Chart: ${a.fourHPhoto}\n`;
        }
        template += `\n`;
    }
    
    // 1H
    if (a.oneHAnalysis || a.oneHPhoto) {
        template += `‚ö° 1H TIMEFRAME\n`;
        template += `${'‚îÄ'.repeat(50)}\n`;
        if (a.oneHAnalysis) {
            template += `${a.oneHAnalysis}\n`;
        }
        if (a.oneHPhoto) {
            template += `\nüì∏ Chart: ${a.oneHPhoto}\n`;
        }
        template += `\n`;
    }
    
    template += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
    template += `üí° Analysis by @YourUsername | ${dateStr}\n`;
    template += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
    
    // Copy to clipboard
    navigator.clipboard.writeText(template).then(() => {
        // Show success message
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        btn.style.background = 'linear-gradient(135deg, #00cc88, #00aa72)';
        
        setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = 'linear-gradient(135deg, #2962FF, #1E53E5)';
        }, 2000);
    }).catch(err => {
        alert('Copy failed! Please try again.');
        console.error(err);
    });
}

// Save
saveBtn.onclick = () => {
    const analysis = getFormData();
    if (!analysis) return;
    
    if (editingIndex >= 0 && analyses[editingIndex]?.id) {
        analysis.id = analyses[editingIndex].id;
        updateAnalysis(analysis);
    } else {
        addAnalysis(analysis);
    }
};

function getFormData() {
    const required = ['month', 'day', 'date', 'year', 'pair'];
    for (const id of required) {
        if (!document.getElementById(id).value) {
            alert('Please fill Month, Day, Date, Year, and Pair');
            return null;
        }
    }
    
    // Get pair value (handle "Other" option)
    let pairValue = document.getElementById('pair').value;
    if (pairValue === 'Other') {
        pairValue = document.getElementById('customPair').value;
        if (!pairValue || pairValue.trim() === '') {
            alert('Please enter a custom pair');
            return null;
        }
    }
    
    return {
        month: document.getElementById('month').value,
        day: document.getElementById('day').value,
        date: document.getElementById('date').value,
        year: document.getElementById('year').value,
        pair: pairValue,
        weeklyAnalysis: document.getElementById('weeklyAnalysis').value,
        weeklyPhoto: document.getElementById('weeklyPhoto').value,
        dailyAnalysis: document.getElementById('dailyAnalysis').value,
        dailyPhoto: document.getElementById('dailyPhoto').value,
        fourHAnalysis: document.getElementById('fourHAnalysis').value,
        fourHPhoto: document.getElementById('fourHPhoto').value,
        oneHAnalysis: document.getElementById('oneHAnalysis').value,
        oneHPhoto: document.getElementById('oneHPhoto').value
    };
}

function addAnalysis(analysis) {
    showLoading();
    const qs = new URLSearchParams({ action: 'add', ...analysis });
    fetch(GOOGLE_SCRIPT_URL + '?' + qs)
        .then(() => {
            hideLoading();
            clearForm();
            showPage('list');
            loadAnalyses();
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            alert('Save error');
        });
}

function updateAnalysis(analysis) {
    showLoading();
    const qs = new URLSearchParams({ action: 'update', ...analysis });
    fetch(GOOGLE_SCRIPT_URL + '?' + qs)
        .then(() => {
            hideLoading();
            editingIndex = -1;
            clearForm();
            showPage('list');
            loadAnalyses();
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            alert('Update error');
        });
}

function editAnalysis(i) {
    editingIndex = i;
    const a = analyses[i];
    
    // Handle pair selection (check if it's a predefined pair or custom)
    const predefinedPairs = ['EUR/USD', 'GBP/USD', 'XAU/USD', 'USD/JPY', 'US100', 'GER40'];
    if (predefinedPairs.includes(a.pair)) {
        document.getElementById('pair').value = a.pair;
        document.getElementById('customPairGroup').style.display = 'none';
    } else {
        document.getElementById('pair').value = 'Other';
        document.getElementById('customPair').value = a.pair;
        document.getElementById('customPairGroup').style.display = 'block';
    }
    
    document.getElementById('month').value = a.month || '';
    document.getElementById('day').value = a.day || '';
    document.getElementById('date').value = a.date || '';
    document.getElementById('year').value = a.year || '';
    document.getElementById('weeklyAnalysis').value = a.weeklyAnalysis || '';
    document.getElementById('weeklyPhoto').value = a.weeklyPhoto || '';
    document.getElementById('dailyAnalysis').value = a.dailyAnalysis || '';
    document.getElementById('dailyPhoto').value = a.dailyPhoto || '';
    document.getElementById('fourHAnalysis').value = a.fourHAnalysis || '';
    document.getElementById('fourHPhoto').value = a.fourHPhoto || '';
    document.getElementById('oneHAnalysis').value = a.oneHAnalysis || '';
    document.getElementById('oneHPhoto').value = a.oneHPhoto || '';
    
    showPage('form');
}

function deleteAnalysis(i) {
    if (!confirm('Delete this analysis?')) return;
    showLoading();
    fetch(`${GOOGLE_SCRIPT_URL}?action=delete&id=${analyses[i].id}`)
        .then(() => {
            hideLoading();
            loadAnalyses();
        })
        .catch(err => {
            console.error(err);
            hideLoading();
            alert('Delete error');
        });
}

function clearForm() {
    ['month', 'day', 'date', 'year', 'pair', 'weeklyAnalysis', 'weeklyPhoto',
     'dailyAnalysis', 'dailyPhoto', 'fourHAnalysis', 'fourHPhoto',
     'oneHAnalysis', 'oneHPhoto'].forEach(id => {
        document.getElementById(id).value = '';
    });
    editingIndex = -1;
}

// View Mode Switch
function switchView(mode) {
    const journalView = document.getElementById('journalView');
    const calendarView = document.getElementById('calendarView');
    const btnJournal = document.getElementById('btnJournalView');
    const btnCalendar = document.getElementById('btnCalendarView');
    
    if (mode === 'journal') {
        journalView.style.display = 'block';
        calendarView.style.display = 'none';
        btnJournal.classList.add('active');
        btnCalendar.classList.remove('active');
    } else {
        journalView.style.display = 'none';
        calendarView.style.display = 'block';
        btnJournal.classList.remove('active');
        btnCalendar.classList.add('active');
        renderCalendar();
    }
}

// Calendar Functions
let currentSelectedDate = null;

function changeMonth(delta) {
    const monthSelect = document.getElementById('calendarMonth');
    const yearSelect = document.getElementById('calendarYear');
    
    let month = parseInt(monthSelect.value);
    let year = parseInt(yearSelect.value);
    
    month += delta;
    
    if (month < 0) {
        month = 11;
        year--;
    } else if (month > 11) {
        month = 0;
        year++;
    }
    
    monthSelect.value = month;
    yearSelect.value = year;
    renderCalendar();
}

function renderCalendar() {
    const month = parseInt(document.getElementById('calendarMonth').value);
    const year = parseInt(document.getElementById('calendarYear').value);
    const grid = document.getElementById('calendarGrid');
    
    grid.innerHTML = '';
    
    // Add day headers
    const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    days.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-header';
        header.textContent = day;
        grid.appendChild(header);
    });
    
    // Get first day of month
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();
    
    // Adjust first day (make Monday = 0)
    const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
    
    // Add previous month's days
    for (let i = adjustedFirstDay - 1; i >= 0; i--) {
        const dayDiv = createDayCell(daysInPrevMonth - i, month - 1, year, true);
        grid.appendChild(dayDiv);
    }
    
    // Add current month's days
    for (let day = 1; day <= daysInMonth; day++) {
        const dayDiv = createDayCell(day, month, year, false);
        grid.appendChild(dayDiv);
    }
    
    // Add next month's days to fill grid
    const totalCells = grid.children.length - 7;
    const remainingCells = 42 - totalCells - 7;
    for (let day = 1; day <= remainingCells; day++) {
        const dayDiv = createDayCell(day, month + 1, year, true);
        grid.appendChild(dayDiv);
    }
}

function createDayCell(day, month, year, isOtherMonth) {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'calendar-day';
    
    if (isOtherMonth) {
        dayDiv.classList.add('other-month');
    }
    
    // Adjust month for proper date creation
    let actualMonth = month;
    let actualYear = year;
    if (month < 0) {
        actualMonth = 11;
        actualYear = year - 1;
    } else if (month > 11) {
        actualMonth = 0;
        actualYear = year + 1;
    }
    
    const dateStr = `${actualYear}-${String(actualMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    
    // Count analyses for this day
    const analysesForDay = analyses.filter(a => a.date === dateStr);
    
    if (analysesForDay.length > 0 && !isOtherMonth) {
        dayDiv.classList.add('has-analysis');
    }
    
    // Check if selected
    if (currentSelectedDate === dateStr && !isOtherMonth) {
        dayDiv.classList.add('selected');
    }
    
    const dayNumber = document.createElement('div');
    dayNumber.className = 'calendar-day-number';
    dayNumber.textContent = day;
    dayDiv.appendChild(dayNumber);
    
    if (analysesForDay.length > 0 && !isOtherMonth) {
        const count = document.createElement('div');
        count.className = 'calendar-day-count';
        count.textContent = `${analysesForDay.length} ${analysesForDay.length === 1 ? 'analysis' : 'analyses'}`;
        dayDiv.appendChild(count);
    }
    
    if (!isOtherMonth) {
        dayDiv.onclick = () => showAnalysesForDay(dateStr, day, actualMonth, actualYear);
    }
    
    return dayDiv;
}

function showAnalysesForDay(dateStr, day, month, year) {
    currentSelectedDate = dateStr;
    renderCalendar();
    
    const analysesForDay = analyses.filter(a => a.date === dateStr);
    const container = document.getElementById('selectedDayAnalyses');
    const title = document.getElementById('selectedDayTitle');
    const content = document.getElementById('selectedDayContent');
    
    if (analysesForDay.length === 0) {
        container.style.display = 'none';
        return;
    }
    
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    title.textContent = `üìÖ ${day} ${monthNames[month]} ${year} - ${analysesForDay.length} ${analysesForDay.length === 1 ? 'Analysis' : 'Analyses'}`;
    
    content.innerHTML = '';
    
    analysesForDay.forEach((a, index) => {
        const card = document.createElement('div');
        card.style.cssText = 'background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 149, 0, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 15px;';
        
        card.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="color: #ff9500; margin: 0; font-size: 1.3em;">${a.pair}</h4>
                <div style="display: flex; gap: 10px;">
                    <button onclick="viewAnalysis(${analyses.indexOf(a)})" style="background: linear-gradient(135deg, #4d9fff, #3d7fff); color: #fff; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9em; font-weight: 600;">
                        üëÅÔ∏è View Full Analysis
                    </button>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; color: #ddd; font-size: 0.95em;">
                ${a.weeklyAnalysis ? `<div><strong style="color: #ff9500;">üìÖ Weekly:</strong><br>${a.weeklyAnalysis.substring(0, 100)}${a.weeklyAnalysis.length > 100 ? '...' : ''}</div>` : ''}
                ${a.dailyAnalysis ? `<div><strong style="color: #4d9fff;">üìä Daily:</strong><br>${a.dailyAnalysis.substring(0, 100)}${a.dailyAnalysis.length > 100 ? '...' : ''}</div>` : ''}
                ${a.fourHAnalysis ? `<div><strong style="color: #9c27b0;">‚è±Ô∏è 4H:</strong><br>${a.fourHAnalysis.substring(0, 100)}${a.fourHAnalysis.length > 100 ? '...' : ''}</div>` : ''}
                ${a.oneHAnalysis ? `<div><strong style="color: #00cc88;">‚ö° 1H:</strong><br>${a.oneHAnalysis.substring(0, 100)}${a.oneHAnalysis.length > 100 ? '...' : ''}</div>` : ''}
            </div>
        `;
        
        content.appendChild(card);
    });
    
    container.style.display = 'block';
}

// Init
window.onload = () => {
    checkAuth();
    loadAnalyses();
    
    // Set calendar to current month/year
    const now = new Date();
    document.getElementById('calendarMonth').value = now.getMonth();
    document.getElementById('calendarYear').value = now.getFullYear();
};
    </script>
</body>
</html>
